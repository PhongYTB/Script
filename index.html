<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phong Hub - Công Cụ & Giải Trí</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, query, onSnapshot, serverTimestamp, getDocs, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- GLOBAL SETUP ---
        // Biến toàn cục để sử dụng trong JS
        window.firebase = {
            initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged,
            getFirestore, doc, setDoc, collection, query, onSnapshot, serverTimestamp, getDocs, orderBy, limit
        };
        window.APP = {
            db: null,
            auth: null,
            userId: null,
            isAuthReady: false,
            // Cấu hình Firebase được cung cấp bởi môi trường
            firebaseConfig: typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null,
            authToken: typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null,
            appId: typeof __app_id !== 'undefined' ? __app_id : 'default-phong-hub',
        };

        async function initFirebase() {
            if (!window.APP.firebaseConfig) {
                console.error("Firebase config is missing.");
                return;
            }

            const app = firebase.initializeApp(window.APP.firebaseConfig);
            window.APP.db = firebase.getFirestore(app);
            window.APP.auth = firebase.getAuth(app);

            // Đăng nhập hoặc sử dụng token
            if (window.APP.authToken) {
                await firebase.signInWithCustomToken(window.APP.auth, window.APP.authToken).catch(e => {
                    console.error("Custom token sign-in failed, falling back to anonymous.", e);
                    return firebase.signInAnonymously(window.APP.auth);
                });
            } else {
                await firebase.signInAnonymously(window.APP.auth);
            }

            firebase.onAuthStateChanged(window.APP.auth, (user) => {
                if (user) {
                    window.APP.userId = user.uid;
                } else {
                    window.APP.userId = crypto.randomUUID();
                }
                window.APP.isAuthReady = true;
                console.log("Firebase Auth Ready. User ID:", window.APP.userId);
                // Đảm bảo window.appLogic tồn tại trước khi gọi startApp
                if (window.appLogic && typeof window.appLogic.startApp === 'function') {
                    window.appLogic.startApp();
                }
            });
        }

        initFirebase();
    </script>
    <!-- Thư viện AES/Crypto-JS (chỉ cần 1 phần) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --primary: #8b5cf6; /* Violet */
            --primary-dark: #7c3aed;
            --secondary: #10b981; /* Emerald */
            --bg-dark: #1f2937;
            --card-bg: #374151;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: #e5e7eb;
        }
        .sidebar {
            background-color: #111827;
        }
        .nav-item {
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }
        .nav-item.active {
            border-left-color: var(--primary);
            background-color: #374151;
            color: #fff;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .copy-btn {
            transition: all 0.3s;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

    <!-- Custom Modal Structure -->
    <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden items-center justify-center p-4">
        <div class="bg-card-bg p-6 rounded-xl shadow-2xl max-w-sm w-full border-t-4 border-primary">
            <h3 id="modal-title" class="text-xl font-bold mb-3 text-white">Thông báo</h3>
            <p id="modal-content" class="text-gray-300 mb-6"></p>
            <div id="modal-actions" class="flex justify-end space-x-3">
                <button id="modal-close" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-white font-semibold transition">Đóng</button>
                <!-- Nút Tùy chọn, ví dụ: "Tiếp tục" -->
            </div>
        </div>
    </div>

    <!-- Sidebar (Menu Cố Định) -->
    <nav class="sidebar md:w-64 w-full md:min-h-screen p-4 flex md:flex-col flex-row overflow-x-auto md:overflow-y-auto custom-scrollbar shadow-xl md:shadow-none">
        <h1 class="text-3xl font-extrabold text-primary mb-6 whitespace-nowrap">Phong Hub</h1>
        <div id="nav-links" class="flex md:flex-col flex-row space-x-3 md:space-x-0 md:space-y-2">
            <!-- Navigation links will be rendered here -->
        </div>
        <!-- Thêm phần Giới Thiệu cố định ở cuối cho desktop -->
        <div class="mt-auto pt-6 hidden md:block">
            <h4 class="text-sm font-semibold text-gray-500 mb-1">Created by:</h4>
            <p class="text-sm text-gray-400">phongYTB</p>
            <a href="https://tiktok.com/@hnphong_anime" target="_blank" class="text-sm text-primary hover:text-primary-dark transition">
                TikTok: hnphong_anime
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow p-4 md:p-8">
        <!-- Content will be rendered here -->
        <div class="flex items-center justify-center h-full min-h-[300px]">
            <p id="loading-message" class="text-xl text-gray-400 animate-pulse">Đang khởi tạo ứng dụng và kết nối Firebase...</p>
        </div>
    </main>

    <script>
        // Lấy trạng thái Key Premium đã lưu từ localStorage
        const storedKeyValid = localStorage.getItem('phonghub_admin_key_valid') === 'true';

        // --- GLOBAL STATE ---
        const APP_STATE = {
            view: 'gioi-thieu', // current active section
            encryption: {
                key: "Roland", // Mặc định cho AES
            },
            ai: {
                mode: 'chat', // 'chat' hoặc 'image'
                chatHistory: [],
                imagePrompt: '',
                isLoading: false,
                lastResult: null,
            },
            keyPremium: {
                enteredKey: '',
                isValid: storedKeyValid, // <--- Sử dụng trạng thái đã lưu
                visitorLogs: [],
                currentUserIP: 'Đang tải...',
            },
            scripts: {
                currentCategory: 'brainrot', // 'brainrot' hoặc 'garden'
            },
            games: {
                // Game States will be initialized later
            }
        };

        // --- DATA BỘ DỮ LIỆU ---

        const ENCRYPTION_TYPES = [
            { id: 'base64', name: 'Base64 (Mã hóa cơ bản)' },
            { id: 'url', name: 'URL Encoding (Mã hóa Web)' },
            { id: 'caesar', name: 'Caesar Cipher (Dịch 3 ký tự)' },
            { id: 'aes', name: 'AES (Mật mã Mạnh - Key: Roland)' },
        ];

        const SCRIPT_DATA = {
            brainrot: [
                { name: "Lemon Hub", script: 'loadstring(game:HttpGet("https://api.luarmor.net/files/v3/loaders/ffdfeadf0af798741806ea404682a938.lua"))()' },
                { name: "Arbix Hub New", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Youifpg/Steal-a-Brianrot/refs/heads/main/ArbixHubBEST.lua"))()' },
                { name: "Blue X Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Dev-BlueX/BlueX-Hub/refs/heads/main/Main.lua"))()' },
                { name: "Dencrycode", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Estevansit0/KJJK/refs/heads/main/PusarX-loader.lua"))()' },
                { name: "Ugly Hub", script: 'script_key="Your_Key"; loadstring(game:HttpGet("https://api.luarmor.net/files/v3/loaders/77d72e34c893b67ea49b8d62d1a18485.lua"))()' },
                { name: "Lumin Hub", script: 'loadstring(game:HttpGet("https://lumin-hub.lol/loader.lua"))()' },
                { name: "Tuấn Anh IOS", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/AnhTuanDzai-Hub/TuanAnhIOS/refs/heads/main/BrainRotVip"))()' },
                { name: "Steel A Mod", script: 'loadstring(game:HttpGet("https://rawscripts.net/raw/Steal-a-Brainrot-MODDED-INSTANT-STEALS-EASY-CASH-AND-MORE-KEYLESS-42520"))()' },
                { name: "Chilli Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/tienkhanh1/spicy/main/Chilli.lua"))()' },
                { name: "Steel a Brainnot", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Estevansit0/KJJK/refs/heads/main/PusarX-loader.lua"))()' },
                { name: "Vakat Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/vokamc/main/refs/heads/main/vokathub"))()' },
                { name: "Open GUI", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/iw929wiwiw/Teleport-Speed/refs/heads/main/Fall%20Down"))()' },
                { name: "Makal Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/DoliScriptz/loader/refs/heads/main/main.lua", true))()' },
                { name: "Arbix Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Youifpg/Steal-a-Brianrot/refs/heads/main/Instant%20steal.lua"))()' },
                { name: "Xxlegendxx", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Akbar123s/Script-Roblox-/refs/heads/main/nabaruBrainrot"))()' },
                { name: "Delfi Hub", script: 'loadstring(game:HttpGet("https://pastefy.app/eCzs7DNQ/raw"))()' },
                { name: "Ronix Hub", script: 'loadstring(game:HttpGet("pastebin.com/raw/HFx6faQY"))()' },
                { name: "AvOnTop Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Ayvathion/AV-On-Top/refs/heads/main/Loader.lua"))()' },
                { name: "Lurk Hack", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/egor2078f/lurkhackv4/main/main.lua"))()' },
                { name: "Timmy Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/WinzeTim/timmyhack2/refs/heads/main/stealabrainrot.lua"))()' },
            ],
            garden: [
                { name: "ThundeZ Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/ThundarZ/Welcome/refs/heads/main/Main/GaG/Main.lua"))()' },
                { name: "Auto Tự Động Chơi", script: 'loadstring(game:HttpGet("https://pastefy.app/OT23uo9U/raw"))()' },
                { name: "Speed Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua"))()' },
                { name: "Nat Hub", script: 'loadstring(game:HttpGet("https://get.nathub.xyz/loader"))()' },
                { name: "OMG Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Omgshit/Scripts/main/MainLoader.lua"))()' },
                { name: "Lumin Hub", script: 'loadstring(game:HttpGet("https://lumin-hub.lol/loader.lua"))()' },
                { name: "Ransom Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/imFiftyyOne/RansomHub/refs/heads/main/Gag"))()' },
                { name: "No-Lag V2 Hub", script: 'loadstring(game:HttpGet("https://api.luarmor.net/files/v3/loaders/3b2169cf53bc6104dabe8e19562e5cc2.lua"))()' },
                { name: "No-Lag V1 Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/NoLag-id/No-Lag-HUB/refs/heads/main/Loader/LoaderV1.lua"))()' },
                { name: "Moma Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/n3xkxp3rl/Moma-Hub/refs/heads/main/GrowAGarden.lua"))()' },
                { name: "Thunder Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/ThundarZ/Welcome/refs/heads/main/Main/GaG/Main.lua"))()' },
                { name: "PhantFluxReal", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/sudaisontopxd/PanScriptXSudaisScript/refs/heads/main/PhantFluxReal.lua"))()' },
                { name: "Kura Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/checkurasshole/Script/refs/heads/main/IQ"))()' },
                { name: "Tora Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/gumanba/Scripts/main/GrowaGarden"))()' },
                { name: "Lion Hub Kaitun", script: 'loadstring(game:HttpGet("https://pastefy.app/KAZUgCRO/raw"))()' },
                { name: "AVOnTop", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Ayvathion/AV-On-Top/refs/heads/main/Loader.lua"))()' },
                { name: "Tbao Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/tbao143/game/refs/heads/main/TbaoHubGrowGarden"))()' },
                { name: "Y Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/yue-os/script/refs/heads/main/Y-Hub"))()' },
                { name: "Galactic Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/GalacticScripts/Galactic-Hub/refs/heads/main/Galactic%20Hub"))()' },
                { name: "Beecon Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/BaconBossScript/BeeconHub/main/BeeconHub"))()' },
                { name: "Kenniel Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Kenniel123/Grow-a-garden/refs/heads/main/Grow%20A%20Garden"))()' },
                { name: "Gag Dupe Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Bern0va/Scripts/refs/heads/main/gag-dupe.lua"))()' },
                { name: "Blue Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/tesghg/Grow-a-Garden/main/ameicaa_Grow_A_Garden.lua"))()' },
                { name: "Nicuse Hub", script: 'loadstring(game:HttpGet("https://nicuse.xyz/MainHub.lua"))()' },
                { name: "Alchemy Hub", script: 'loadstring(game:HttpGet("https://scripts.alchemyhub.xyz"))()' },
                { name: "Grow A Garden V0.71", script: 'loadstring(game:HttpGet("https://lunor.dev/loader"))()' },
                { name: "H4xScr Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/H4xScripts/Loader/refs/heads/main/loader2.lua"))()' },
                { name: "OP Script Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/nf-36/Koronis/refs/heads/main/Scripts/Loader.lua"))()' },
                { name: "Lunacy Hub", script: 'loadstring(game:HttpGet("https://api.luarmor.net/files/v3/loaders/1c1979f776d3e81869cf5f49f91900a7.lua"))()' },
                { name: "Native Hub", script: 'script_key="PASTE_KEY_HERE"; (loadstring or load)(game:HttpGet("https://getnative.cc/script/loader"))()' },
                { name: "Vexeze Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Dex-Bear/Vxezehub/refs/heads/main/VxezeHubMain"))()' },
                { name: "Dinga Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Dingarik/Dingarik/refs/heads/main/GrowAGarden"))()' },
                { name: "Grow A Garden 1 (mauscripts)", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/nootmaus/GrowAAGarden/refs/heads/main/mauscripts"))()' },
                { name: "Grow A Garden 1 (gumanba)", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/gumanba/Scripts/refs/heads/main/GrowaGarden"))()' },
                { name: "Doggo Hub", script: 'loadstring(game:HttpGet("https://cheater.fun/hacks_roblox/10886-grow-a-garden-script.html"))()' },
            ]
        };

        const CLIENT_DATA = [
            { name: "Delta X VNG", update: "23/09/2025", status: "Hoạt Động", version: "V2.690", antiBan: "Có", link: "https://www.mediafire.com/file/sr0uoqc0cfqmv4r/Delta_Vng-2.690.721_Up.apk/file" },
            { name: "Hack Fluxus", update: "04/09/2025", status: "Không Hoạt Động", version: "V2.688", antiBan: "Có", link: "https://www.mediafire.com/folder/hdnexqcju1bfq/Fluxus" },
            { name: "Hack Arceus X", update: "23/09/2025", status: "Hoạt Động", version: "V2.690", antiBan: "Có", link: "https://www.mediafire.com/file/8as090ll3x8fup6/ArceusX.2.691.868.apk/file" },
            { name: "Pixel Launcher Lite", update: "N/A", status: "Tool", version: "Mod Pro", antiBan: "N/A", link: "https://www.mediafire.com/file/dllutrxsomivrhw/Launcher_Lite.apk/file" },
            { name: "F1 VM VIP APK", update: "N/A", status: "Tool", version: "Mod VIP", antiBan: "N/A", link: "https://www.mediafire.com/file/fwpstknlrszwsys/F1VM_V1.3.1.2.01_Mod_VIP.apk/file" },
        ];

        const ACCOUNT_DATA = [
            { price: '50k', game: 'FF Random', image: 'https://placehold.co/150x250/22c55e/ffffff?text=FF+50K', details: 'Acc Free Fire ngẫu nhiên.' },
            { price: '100k', game: 'FF Random', image: 'https://placehold.co/150x250/22c55e/ffffff?text=FF+100K', details: 'Acc Free Fire ngẫu nhiên VIP hơn.' },
            { price: '150k', game: 'FF Random', image: 'https://placehold.co/150x250/22c55e/ffffff?text=FF+150K', details: 'Acc Free Fire ngẫu nhiên siêu VIP.' },
            { price: '70k', game: 'Roblox Tùy Chọn', image: 'https://placehold.co/150x250/8b5cf6/ffffff?text=Roblox+70K', details: 'Acc Roblox tùy chọn cơ bản.' },
            { price: '80k', game: 'Roblox Tùy Chọn', image: 'https://placehold.co/150x250/8b5cf6/ffffff?text=Roblox+80K', details: 'Acc Roblox tùy chọn Tốt.' },
            { price: '10k', game: 'Roblox Tùy Chọn', image: 'https://placehold.co/150x250/8b5cf6/ffffff?text=Roblox+10K', details: 'Acc Roblox tùy chọn Rẻ nhất.' },
            { price: '300k', game: 'Roblox Tùy Chọn', image: 'https://placehold.co/150x250/8b5cf6/ffffff?text=Roblox+300K', details: 'Acc Roblox tùy chọn Max VIP.' },
            { price: '210k', game: 'Roblox Tùy Chọn', image: 'https://placehold.co/150x250/8b5cf6/ffffff?text=Roblox+210K', details: 'Acc Roblox tùy chọn VIP.' },
        ];


        // --- FIREBASE / ADMIN LOGIC ---

        const adminLogVisitor = async () => {
            if (typeof window.APP === 'undefined' || !window.APP.isAuthReady || !window.APP.db) return;

            let ip = '127.0.0.1 (Local)';
            let geoData = {
                country: 'N/A',
                regionName: 'N/A',
                city: 'N/A',
                isp: 'N/A', 
                org: 'N/A'
            };

            try {
                // 1. Lấy IP mô phỏng
                const ipResponse = await fetch("https://api.ipify.org?format=json");
                const ipData = await ipResponse.json();
                ip = ipData.ip || ip;
                APP_STATE.keyPremium.currentUserIP = ip;

                // 2. Lấy Geo-IP data
                // ip-api.com là dịch vụ Geo-IP miễn phí
                const geoResponse = await fetch(`https://ip-api.com/json/${ip}?fields=status,country,regionName,city,isp,org`);
                const geoIpData = await geoResponse.json();

                if (geoIpData.status === 'success') {
                    geoData.country = geoIpData.country || 'N/A';
                    geoData.region
