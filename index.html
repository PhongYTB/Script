<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phong Hub - Công Cụ & Giải Trí</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải Thư viện Crypto-JS cho mã hóa AES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        
        :root {
            --primary: #8b5cf6; /* Violet */
            --primary-dark: #7c3aed;
            --secondary: #10b981; /* Emerald */
            --bg-dark: #1f2937;
            --card-bg: #374151;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: #e5e7eb;
        }
        .sidebar {
            background-color: #111827;
        }
        .nav-item {
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }
        .nav-item.active {
            border-left-color: var(--primary);
            background-color: #374151;
            color: #fff;
        }
        /* Custom Scrollbar for better UX */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .copy-btn {
            transition: all 0.3s;
        }

        /* Ẩn nội dung chính ban đầu */
        #main-app-container {
            display: none;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #main-app-container.visible {
            display: block; /* Đặt lại thành block vì sidebar đã là fixed/absolute */
            opacity: 1;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Custom Modal Structure -->
    <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden items-center justify-center p-4">
        <div class="bg-card-bg p-6 rounded-xl shadow-2xl max-w-sm w-full border-t-4 border-primary">
            <h3 id="modal-title" class="text-xl font-bold mb-3 text-white">Thông báo</h3>
            <p id="modal-content" class="text-gray-300 mb-6"></p>
            <div id="modal-actions" class="flex justify-end space-x-3">
                <button id="modal-close" onclick="hideModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-white font-semibold transition">Đóng</button>
            </div>
        </div>
    </div>

    <!-- Màn Hình Khóa (Lock Screen) - Hiển thị mặc định -->
    <div id="lock-screen" class="fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-50 p-6 text-center">
        <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-6">FOLLOW KÊNH TIKTOK ĐỂ LẤY SCRIPTS</h1>
        <p class="text-lg text-gray-300 mb-8 max-w-md">
            Vui lòng thực hiện **Bước 1** (Follow Kênh TikTok) để kích hoạt nút mở khóa và truy cập kho Scripts/Công cụ.
        </p>
        
        <div class="space-y-4 w-full max-w-sm">
            <!-- Nút 1: Đến Kênh TikTok (Open TikTok) -->
            <button id="tiktok-link-btn" onclick="openTikTok()"
                class="w-full py-4 bg-primary hover:bg-primary-dark text-white font-bold rounded-xl shadow-lg transition transform hover:scale-[1.03] flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M9 0h1.8c.123 1.545.424 3.141.794 4.095.385.996 1.055 2.115 1.554 2.378.36.194.887.214 1.25-.138.083-.079.167-.162.25-.245v2.8a.7.7 0 0 1-.3.518c-.464.382-1.39.462-2.316.353-1.076-.128-2.146-.477-3.153-1.01-1.437-.77-2.67-1.7-3.414-3.085-1.127-2.074-1.157-5.07-.184-7.075h2.245c-.328 1.96.143 3.992.937 5.56.88.75 1.956 1.34 3.012 1.57V0zm.8 4.07h.78V.74h-.78V4.07z"/>
                </svg>
                1. FOLLOW KÊNH TIKTOK (hnphong_anime)
            </button>
            
            <!-- Nút 2: Mở Khóa (Unlock) - Ban đầu disabled và màu đỏ đậm -->
            <button id="unlock-btn" disabled onclick="unlockApp()"
                class="w-full py-4 bg-red-800 text-white font-bold rounded-xl shadow-lg transition duration-300">
                2. MỞ KHÓA WEB (Chưa sẵn sàng)
            </button>
            
            <p id="unlock-message" class="text-sm text-red-400 pt-4">Hoàn tất Bước 1 để kích hoạt nút Mở Khóa.</p>
        </div>
    </div>


    <!-- Toàn bộ Ứng dụng chính (Header Mobile + Sidebar + Main Content) -->
    <div id="main-app-container" class="w-full min-h-screen">

        <!-- Header Mobile (Chỉ hiển thị trên Mobile) -->
        <header class="bg-gray-800 p-4 flex justify-between items-center md:hidden shadow-lg fixed top-0 left-0 right-0 z-40">
            <h1 class="text-2xl font-extrabold text-primary">Phong Hub</h1>
            <button id="menu-toggle-btn" onclick="toggleMenu()" class="text-white focus:outline-none p-2 rounded-lg hover:bg-gray-700">
                <!-- Hamburger Icon -->
                <svg id="menu-icon-open" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
                </svg>
                 <!-- Close Icon (Hidden initially) -->
                <svg id="menu-icon-close" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </header>


        <!-- Sidebar (Menu Cố Định/Thu Gọn) -->
        <nav id="sidebar" class="sidebar md:w-64 w-64 fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out z-40 p-4 flex flex-col md:relative md:shadow-none shadow-xl min-h-screen">
            <!-- Logo cho Desktop -->
            <h1 class="text-3xl font-extrabold text-primary mb-6 hidden md:block">Phong Hub</h1>
            
            <!-- Menu links -->
            <div id="nav-links" class="flex flex-col space-y-2 pb-4 flex-grow custom-scrollbar overflow-y-auto">
                <!-- Navigation links will be rendered here -->
            </div>

            <!-- Thêm phần Giới Thiệu cố định ở cuối -->
            <div class="pt-6 border-t border-gray-700 mt-auto">
                <h4 class="text-sm font-semibold text-gray-500 mb-1">Created by:</h4>
                <p class="text-sm text-gray-400">phongYTB</p>
                <a href="https://tiktok.com/@hnphong_anime" target="_blank" class="text-sm text-primary hover:text-primary-dark transition">
                    TikTok: hnphong_anime
                </a>
            </div>
        </nav>

        <!-- Main Content (Sẽ có margin trên desktop và padding-top trên mobile) -->
        <main id="main-content" class="flex-grow p-4 md:p-8 pt-[64px] md:pt-8 w-full md:ml-64">
            <!-- Nội dung sẽ được render tại đây sau khi mở khóa -->
        </main>
    </div>

    <!-- Script Block - Sử dụng type="module" để import Firebase -->
    <script type="module">
        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, addDoc, collection, query, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        setLogLevel('Debug');

        // --- GLOBAL STATE & ENVIRONMENT VARIABLES ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db, auth, userId; 

        const APP_STATE = {
            view: 'gioi-thieu', 
            encryption: {
                key: "Roland",
            },
            keyPremium: {
                isValid: false, 
                currentUserUUID: crypto.randomUUID(), 
            },
            scripts: {
                currentCategory: 'brainrot',
                searchQuery: '', 
            },
        };

        const ENCRYPTION_SECRET_KEY = APP_STATE.encryption.key;
        const ADMIN_KEY = 'adminphong'; 

        // --- DATA BỘ DỮ LIỆU CỨNG ---
        const ENCRYPTION_TYPES = [
            { id: 'base64', name: 'Base64 (Mã hóa cơ bản)' },
            { id: 'url', name: 'URL Encoding (Mã hóa Web)' },
            { id: 'caesar', name: 'Caesar Cipher (Dịch 3 ký tự)' },
            { id: 'aes', name: 'AES (Mật mã Mạnh - Key: Roland)' },
        ];
        
        const SCRIPT_DATA = { 
            brainrot: [
                { name: "Lemon Hub", script: 'loadstring(game:HttpGet("https://api.luarmor.net/files/v3/loaders/ffdfeadf0af798741806ea404682a938.lua"))()' },
                { name: "Arbix Hub New", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Youifpg/Steal-a-Brianrot/refs/heads/main/ArbixHubBEST.lua"))()' },
                { name: "Blue X Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Dev-BlueX/BlueX-Hub/refs/heads/main/Main.lua"))()' },
                { name: "Eclipse Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Fauzi145/V-Hub/main/Eclipse.lua"))()' },
                { name: "Nexuz Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/NexuzHub/NexuzHub/main/Loading.lua"))()' },
                { name: "Venom Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/VenomHub-Script/loader/main/load.lua"))()' },
                { name: "Huz Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/HuzHub/Hub/main/main.lua"))()' },
                { name: "Void Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Void-Scripts/Void-Hub/main/Loader.lua"))()' },
                { name: "Fluxus Hub", script: 'loadstring(game:HttpGet("https://fluxus.vn/loader.lua"))()' },
                { name: "Hydra Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Hydra-Scripts/Loader/main/loader.lua"))()' },
                { name: "Ope Ope Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Ope-Ope-No-Mi/Ope-Ope-No-Mi/main/Loader.lua"))()' },
                { name: "Aimbot", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Aimbot-Script/Loader/main/load.lua"))()' },
                { name: "Script X", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/ScriptX-Script/Loader/main/load.lua"))()' },
                { name: "Vibe Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/VibeHub-Script/Loader/main/load.lua"))()' },
                { name: "Project X", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/ProjectX-Script/Loader/main/load.lua"))()' },
                { name: "Zenith Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/ZenithHub-Script/Loader/main/load.lua"))()' },
                { name: "Inferno Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/InfernoHub-Script/Loader/main/load.lua"))()' },
                { name: "Phantom Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/PhantomHub-Script/Loader/main/load.lua"))()' },
                { name: "Nova Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/NovaHub-Script/Loader/main/load.lua"))()' },
                { name: "Galaxy Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/GalaxyHub-Script/Loader/main/load.lua"))()' },
            ],
            garden: [
                { name: "ThundeZ Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/ThundarZ/Welcome/refs/heads/main/Main/GaG/Main.lua"))()' },
                { name: "Infinity Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Infinity-Script/GaG/main/Load.lua"))()' },
                { name: "Dinga Hub", script: 'loadstring(game:HttpGet("https://raw.githubusercontent.com/Dingarik/Dingarik/refs/heads/main/GrowAGarden"))()' },
            ]
        };

        const CLIENT_DATA = [
            { name: "Delta X VNG", update: "23/09/2025", status: "Hoạt Động", version: "V2.690", antiBan: "Có", link: "https://www.mediafire.com/file/sr0uoqc0cfqmv4r/Delta_Vng-2.690.721_Up.apk/file" },
            { name: "Fluxus Client (Tool)", update: "20/09/2025", status: "Tool", version: "V6.5", antiBan: "Có", link: "https://www.mediafire.com/file/sr0uoqc0cfqmv4r/Delta_Vng-2.690.721_Up.apk/file" },
            { name: "KRNL Client", update: "10/09/2025", status: "Hoạt Động", version: "V1.0", antiBan: "Không", link: "https://www.mediafire.com/file/sr0uoqc0cfqmv4r/Delta_Vng-2.690.721_Up.apk/file" },
            { name: "Executor Pro", update: "01/10/2025", status: "Bảo Trì", version: "V3.2", antiBan: "Có", link: "https://www.mediafire.com/file/sr0uoqc0cfqmv4r/Delta_Vng-2.690.721_Up.apk/file" },
            { name: "GameGuardian Mod", update: "15/09/2025", status: "Hoạt Động", version: "V9.9", antiBan: "Có", link: "https://www.mediafire.com/file/sr0uoqc0cfqmv4r/Delta_Vng-2.690.721_Up.apk/file" },
        ];

        const ACCOUNT_DATA = [
            { price: '50k', game: 'FF Random', image: 'https://placehold.co/150x250/22c55e/ffffff?text=FF+50K', details: 'Acc Free Fire ngẫu nhiên.' },
            { price: '100k', game: 'FF VIP', image: 'https://placehold.co/150x250/ef4444/ffffff?text=FF+VIP', details: 'Acc Free Fire có súng VIP.' },
            { price: '20k', game: 'LQ Random', image: 'https://placehold.co/150x250/3b82f6/ffffff?text=LQ+20K', details: 'Acc Liên Quân ngẫu nhiên.' },
            { price: '150k', game: 'LQ Rank Cao', image: 'https://placehold.co/150x250/f97316/ffffff?text=LQ+150K', details: 'Acc Liên Quân rank Cao Thủ.' },
            { price: '30k', game: 'Roblox Random', image: 'https://placehold.co/150x250/6d28d9/ffffff?text=RBX+30K', details: 'Acc Roblox có gamepass.' },
            { price: '80k', game: 'Minecraft Key', image: 'https://placehold.co/150x250/14b8a6/ffffff?text=MC+80K', details: 'Key Minecraft bản quyền.' },
            { price: '500k', game: 'FF Max Option', image: 'https://placehold.co/150x250/dc2626/ffffff?text=FF+MAX', details: 'Acc Free Fire full tướng, skin hiếm.' },
            { price: '120k', game: 'Blox Fruit Acc', image: 'https://placehold.co/150x250/fbbf24/ffffff?text=BF+120K', details: 'Acc Blox Fruit có trái hiếm.' },
        ];


        // --- ENCRYPTION/DECRYPTION LOGIC (Chức năng Mã Hóa) ---
        const encodeDecode = (text, type, mode) => {
            if (!text) return '';
            if (type === 'aes' && typeof CryptoJS === 'undefined') {
                 return 'Lỗi: Thư viện mã hóa AES chưa tải xong. Vui lòng tải lại trang.';
            }

            try {
                switch (type) {
                    case 'base64':
                        if (mode === 'encrypt') {
                            return CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(text));
                        } else {
                            if (text.length % 4 !== 0 || /[^A-Za-z0-9+/=]/.test(text)) {
                                return 'Lỗi: Chuỗi Base64 không hợp lệ.';
                            }
                            return CryptoJS.enc.Base64.parse(text).toString(CryptoJS.enc.Utf8);
                        }
                    case 'url':
                        return mode === 'encrypt' ? encodeURIComponent(text) : decodeURIComponent(text);
                    case 'caesar':
                         return text.split('').map(char => {
                            const code = char.charCodeAt(0);
                            let shift = mode === 'encrypt' ? 3 : -3;
                            if ((code >= 65 && code <= 90) || (code >= 97 && code <= 122) || (code >= 48 && code <= 57)) {
                                const base = (code >= 65 && code <= 90) ? 65 : (code >= 97 && code <= 122) ? 97 : 48;
                                const max = (code >= 65 && code <= 90) ? 90 : (code >= 97 && code <= 122) ? 122 : 57;
                                const wrap = (max - base) + 1; 
                                
                                let newCode = code - base;
                                newCode = (newCode + shift) % wrap;
                                
                                if (newCode < 0) {
                                    newCode += wrap;
                                }

                                return String.fromCharCode(newCode + base);
                            }
                            return char; 
                        }).join('');
                    case 'aes':
                        if (mode === 'encrypt') {
                            return CryptoJS.AES.encrypt(text, ENCRYPTION_SECRET_KEY).toString();
                        } else {
                            const bytes = CryptoJS.AES.decrypt(text, ENCRYPTION_SECRET_KEY);
                            if (!bytes.sigBytes || bytes.sigBytes === 0) {
                                return 'Lỗi: Key AES sai hoặc dữ liệu không phải mật mã AES hợp lệ.';
                            }
                            try {
                                const result = bytes.toString(CryptoJS.enc.Utf8);
                                return result || 'Lỗi: Giải mã thành công nhưng kết quả là chuỗi rỗng.';
                            } catch (e) {
                                return 'Lỗi: Dữ liệu giải mã không phải là UTF-8 hợp lệ.';
                            }
                        }
                    default:
                        return 'Lỗi: Loại mã hóa không hợp lệ.';
                }
            } catch (e) {
                return `Lỗi xử lý: ${e.message}. Dữ liệu không hợp lệ cho loại mã hóa/giải mã này.`;
            }
        };

        // --- FIREBASE INITIALIZATION & ACCESS LOGGING ---

        async function initializeFirebase() {
            if (!firebaseConfig) {
                console.error("Firebase config is missing. Cannot initialize Firestore.");
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase Init/Auth Error:", error);
                userId = crypto.randomUUID();
                checkLockStatus();
                return;
            }
            
            // Wait for auth state change to get the UID
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                } else {
                    userId = crypto.randomUUID(); 
                }
                
                await logAccess();
                checkLockStatus();
            });
        }

        async function fetchDeviceInfo() {
            const mockIP = `${Math.floor(Math.ra
